# æ•°ç ç®¡æ˜¾ç¤ºä¿®æ”¹è¯´æ˜

**æ—¥æœŸ**: 2025/11/08  
**ä¿®æ”¹ç›®çš„**: åœ¨æ•°ç ç®¡ç¬¬6ä½æ˜¾ç¤ºå½“å‰æ•°æ®æ¨¡å¼ï¼ˆ0=ADC, 1=Phase, 2=Debugï¼‰

---

## ä¿®æ”¹å†…å®¹

### 1. rtl/hs_dual_da.v

#### ä¿®æ”¹1: æ·»åŠ data_modeè¾“å…¥ç«¯å£
```verilog
// æ·»åŠ çš„ç«¯å£
input [1:0] data_mode,  // Data mode (0=ADC, 1=Phase, 2=Debug) from top module (displayed on digit 6)
```

#### ä¿®æ”¹2: ä¿®æ”¹æ•°ç ç®¡æ˜¾ç¤ºé€»è¾‘
```verilog
// åŸé€»è¾‘:
seg_display_data = filter_level * 10000 + display_value

// æ–°é€»è¾‘:
seg_display_data = data_mode * 100000 + filter_level * 10000 + display_value
```

**æ˜¾ç¤ºæ ¼å¼**:
```
[Digit6] [Digit5] [Digit4] [Digit3] [Digit2] [Digit1] [Digit0]
   M        F        -        d        d        d        d

M = data_mode (0/1/2)
F = filter_level (0-9)
dddd = display_value (addr_stepæˆ–phase_diff, 0-9999)
```

#### ä¿®æ”¹3: æ›´æ–°pointå‚æ•°
```verilog
// åŸå‚æ•°: 6'b010000 (åªæ˜¾ç¤ºdigit 5)
// æ–°å‚æ•°: 6'b110000 (æ˜¾ç¤ºdigit 6å’Œdigit 5)
```

---

### 2. rtl/hs_dual_da_hdmi_top.v

#### ä¿®æ”¹1: æ·»åŠ CDCåŒæ­¥å™¨
```verilog
// Data mode CDC synchronized signals (60MHz â†’ 20MHz)
reg [1:0] data_mode_20m_sync1;   // First sync stage
reg [1:0] data_mode_20m_sync2;   // Second sync stage

// CDC alwayså—
always @(posedge clk_20m or negedge rst_n) begin
    if (!rst_n) begin
        data_mode_20m_sync1 <= 2'd0;
        data_mode_20m_sync2 <= 2'd0;
    end else begin
        data_mode_20m_sync1 <= data_mode_60m;
        data_mode_20m_sync2 <= data_mode_20m_sync1;
    end
end
```

**ä¸ºä»€ä¹ˆéœ€è¦CDCåŒæ­¥å™¨ï¼Ÿ**
- data_modeä¿¡å·åœ¨60MHzæ—¶é’ŸåŸŸäº§ç”Ÿï¼ˆhs_adc_top_60mï¼‰
- æ•°ç ç®¡æ˜¾ç¤ºåœ¨20MHzæ—¶é’ŸåŸŸè¿è¡Œï¼ˆhs_dual_daï¼‰
- è·¨æ—¶é’ŸåŸŸä¼ é€’éœ€è¦åŒè§¦å‘å™¨åŒæ­¥ï¼Œé˜²æ­¢äºšç¨³æ€

#### ä¿®æ”¹2: è¿æ¥data_modeåˆ°hs_dual_daå®ä¾‹
```verilog
hs_dual_da u_hs_dual_da (
    // ... å…¶ä»–ç«¯å£ ...
    .filter_level   (filter_level           ),  // Filter level for digit 5
    .data_mode      (data_mode_20m_sync2    ),  // Data mode for digit 6 (CDC synchronized)
    // ... å…¶ä»–ç«¯å£ ...
);
```

---

## ä¿¡å·æµç¨‹å›¾

```
60MHzåŸŸ                        20MHzåŸŸ
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ hs_adc_top_60m  â”‚           â”‚  hs_dual_da  â”‚
â”‚                 â”‚           â”‚              â”‚
â”‚ data_mode_reg   â”‚â”€â”€â”        â”‚              â”‚
â”‚ (2-bit)         â”‚  â”‚        â”‚  seg_led     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚        â”‚  æ˜¾ç¤ºæ¨¡å—    â”‚
                     â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚             â–²
                     â”‚             â”‚
                     â”‚        data_mode (2-bit)
                     â”‚             â”‚
                     â–¼             â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
              â”‚ CDCåŒæ­¥å™¨        â”‚ â”‚
              â”‚ (åŒè§¦å‘å™¨)       â”‚â”€â”˜
              â”‚                  â”‚
              â”‚ sync1 -> sync2   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ•°ç ç®¡æ˜¾ç¤ºç¤ºä¾‹

### æ¨¡å¼0ï¼ˆADCæ¨¡å¼ï¼‰
```
æ˜¾ç¤º: 0 5 0 7 0 5
è§£é‡Š:
  [0] = ADCæ¨¡å¼
  [5] = æ»¤æ³¢å™¨Level 5
  [0705] = addr_step = 705 (215kHz)
```

### æ¨¡å¼1ï¼ˆç›¸ä½æ¨¡å¼ï¼‰
```
æ˜¾ç¤º: 1 5 0 1 2 0
è§£é‡Š:
  [1] = ç›¸ä½æ¨¡å¼
  [5] = æ»¤æ³¢å™¨Level 5
  [0120] = ç›¸ä½å·® = 120åº¦
```

### æ¨¡å¼2ï¼ˆè°ƒè¯•åŒ…æ¨¡å¼ï¼‰
```
æ˜¾ç¤º: 2 5 0 7 0 5
è§£é‡Š:
  [2] = è°ƒè¯•åŒ…æ¨¡å¼
  [5] = æ»¤æ³¢å™¨Level 5
  [0705] = addr_step = 705 (215kHz)
```

---

## æ—¶åºè€ƒè™‘

### CDCå»¶è¿Ÿ
- åŒæ­¥å»¶è¿Ÿï¼š2ä¸ª20MHzæ—¶é’Ÿå‘¨æœŸ = 100ns
- è¿™æ˜¯å¯æ¥å—çš„å»¶è¿Ÿï¼ˆæ•°ç ç®¡åˆ·æ–°ç‡ä¸ºæ‰«æé¢‘ç‡ï¼Œäººçœ¼ä¸å¯å¯Ÿè§‰ï¼‰

### æ˜¾ç¤ºç¨³å®šæ€§
- data_modeå˜åŒ–é¢‘ç‡ï¼šä½ï¼ˆä»…åœ¨æŒ‰é”®åˆ‡æ¢æ—¶ï¼‰
- CDCåŒæ­¥å™¨ï¼šåŒè§¦å‘å™¨ï¼Œé˜²æ­¢äºšç¨³æ€
- æ— æ—¶åºè¿è§„é£é™©

---

## æµ‹è¯•éªŒè¯

### æµ‹è¯•æ­¥éª¤
1. ä¸Šç”µåï¼Œæ•°ç ç®¡ç¬¬6ä½åº”æ˜¾ç¤º **0**ï¼ˆé»˜è®¤ADCæ¨¡å¼ï¼‰
2. çŸ­æŒ‰key[1]ï¼Œæ•°ç ç®¡ç¬¬6ä½å˜ä¸º **1**ï¼ˆç›¸ä½æ¨¡å¼ï¼‰
3. å†æ¬¡çŸ­æŒ‰key[1]ï¼Œæ•°ç ç®¡ç¬¬6ä½å˜ä¸º **2**ï¼ˆè°ƒè¯•åŒ…æ¨¡å¼ï¼‰
4. å†æ¬¡çŸ­æŒ‰key[1]ï¼Œæ•°ç ç®¡ç¬¬6ä½å›åˆ° **0**ï¼ˆå¾ªç¯ï¼‰

### é¢„æœŸç»“æœ
- âœ… æ•°ç ç®¡ç¬¬6ä½æ­£ç¡®æ˜¾ç¤º0/1/2
- âœ… æ•°ç ç®¡ç¬¬5ä½ä»ç„¶æ˜¾ç¤ºæ»¤æ³¢å™¨çº§åˆ«ï¼ˆ0-9ï¼‰
- âœ… æ•°ç ç®¡ç¬¬0-3ä½ä»ç„¶æ˜¾ç¤ºaddr_stepæˆ–phase_diff
- âœ… æŒ‰é”®åˆ‡æ¢å“åº”çµæ•ï¼Œæ— å»¶è¿Ÿæ„Ÿ

---

## Linteræ£€æŸ¥ç»“æœ

âœ… **æ— linteré”™è¯¯**
- rtl/hs_dual_da.v: é€šè¿‡
- rtl/hs_dual_da_hdmi_top.v: é€šè¿‡

---

## æ€»ç»“

æˆåŠŸå®ç°äº†æ•°ç ç®¡ç¬¬6ä½æ˜¾ç¤ºæ•°æ®æ¨¡å¼åŠŸèƒ½ï¼š
- âœ… æ·»åŠ äº†data_modeç«¯å£åˆ°hs_dual_daæ¨¡å—
- âœ… å®ç°äº†60MHzâ†’20MHzçš„CDCåŒæ­¥
- âœ… ä¿®æ”¹äº†æ•°ç ç®¡æ˜¾ç¤ºé€»è¾‘
- âœ… æ›´æ–°äº†æ•°ç ç®¡ä½¿èƒ½ä½
- âœ… æ— æ—¶åºé—®é¢˜ï¼Œæ— linteré”™è¯¯

ç°åœ¨ç”¨æˆ·å¯ä»¥é€šè¿‡æ•°ç ç®¡ç¬¬6ä½å®æ—¶æŸ¥çœ‹å½“å‰çš„æ•°æ®ä¼ è¾“æ¨¡å¼ï¼ğŸ‰

